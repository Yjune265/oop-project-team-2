{% extends "base.html" %}
{% block title %}설문조사 Step 1{% endblock %}

{% block content %}
<div class="row justify-content-center mt-3">
    <div class="col-md-6">
        <h3 class="fw-bold">건강 설문조사 (1/3)</h3>
        <div class="progress mt-2 mb-4" style="height: 6px;">
            <div class="progress-bar" style="width: 33%;"></div>
        </div>

        <div id="surveyForm">
            <div class="custom-card mb-3">
                <label class="fw-bold mb-2">나이</label>
                <input type="number" id="age" class="form-control" placeholder="예: 25">
            </div>

            <div class="custom-card mb-3">
                <label class="fw-bold mb-2">성별</label>
                <div class="row g-2">
                    <div class="col-6"><button class="btn btn-outline-primary w-100 gender-btn" data-value="male">남성</button></div>
                    <div class="col-6"><button class="btn btn-outline-primary w-100 gender-btn" data-value="female">여성</button></div>
                </div>
                <input type="hidden" id="gender">
            </div>

            <div class="custom-card mb-3">
                <label class="fw-bold mb-2">수면 만족도 (1~5)</label>
                <input type="range" class="form-range" min="1" max="5" id="sleepQuality" oninput="document.getElementById('sleepVal').innerText=this.value+'점'">
                <div class="text-center fw-bold text-primary" id="sleepVal">3점</div>
            </div>

            <button class="btn btn-primary w-100 py-3" onclick="nextStep()">다음 Step으로 ></button>
        </div>
    </div>
</div>

<script>
    // 성별 버튼 클릭 효과
    document.querySelectorAll('.gender-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
            this.classList.add('active', 'bg-primary', 'text-white');
            document.getElementById('gender').value = this.dataset.value;
        });
    });

    function nextStep() {
        const age = document.getElementById('age').value;
        const gender = document.getElementById('gender').value;
        const sleep = document.getElementById('sleepQuality').value;

        if(!age || !gender) { alert("모든 항목을 입력해주세요."); return; }

        // 브라우저에 임시 저장
        const step1Data = {
            age: parseInt(age),
            gender: gender,
            stressLevel: '중', // Step 1화면에 없으면 기본값 or 추가필요
            sleepQuality: parseInt(sleep),
            dietHabits: [] // 추후 추가 가능
        };
        sessionStorage.setItem('userProfile', JSON.stringify(step1Data));
        
        location.href = "/survey/step2";
    }
</script>
{% endblock %}