{% extends "base.html" %}
{% block title %}ì„¤ë¬¸ì¡°ì‚¬ Step 1{% endblock %}

{% block content %}
<div class="row justify-content-center mt-3">
    <div class="col-md-7">
        <h3 class="fw-bold text-center">ê±´ê°• ì„¤ë¬¸ì¡°ì‚¬ (1/3)</h3>
        <div class="progress mt-2 mb-4" style="height: 6px;">
            <div class="progress-bar" style="width: 33%;"></div>
        </div>

        <div id="surveyForm">
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <div class="custom-card p-3 h-100">
                        <label class="fw-bold mb-2">ë‚˜ì´</label>
                        <input type="number" id="age" class="form-control" placeholder="ì˜ˆ: 25">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="custom-card p-3 h-100">
                        <label class="fw-bold mb-2">ì„±ë³„</label>
                        <div class="row g-2">
                            <div class="col-6"><button class="btn btn-outline-primary w-100 gender-btn" data-value="male">ë‚¨ì„±</button></div>
                            <div class="col-6"><button class="btn btn-outline-primary w-100 gender-btn" data-value="female">ì—¬ì„±</button></div>
                        </div>
                        <input type="hidden" id="gender">
                    </div>
                </div>
            </div>

            <div class="custom-card mb-3 p-4">
                <h5 class="fw-bold mb-3">ğŸ’¤ ìˆ˜ë©´ í€„ë¦¬í‹°</h5>
                <label class="form-label text-muted small">1ì (ë‚˜ì¨) ~ 5ì (ì¢‹ìŒ)</label>
                <div class="d-flex align-items-center gap-3">
                    <input type="range" class="form-range flex-grow-1" min="1" max="5" id="sleepQuality" oninput="document.getElementById('sleepVal').innerText=this.value+'ì '">
                    <div class="text-primary fw-bold fs-5" id="sleepVal">3ì </div>
                </div>
            </div>

            <div class="custom-card mb-3 p-4">
                <h5 class="fw-bold mb-3">ğŸ¤¯ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨</h5>
                <div class="btn-group w-100" role="group">
                    <button type="button" class="btn btn-outline-success stress-btn" data-value="ë‚®ìŒ">ë‚®ìŒ</button>
                    <button type="button" class="btn btn-outline-warning stress-btn" data-value="ë³´í†µ">ë³´í†µ</button>
                    <button type="button" class="btn btn-outline-danger stress-btn" data-value="ë†’ìŒ">ë†’ìŒ</button>
                </div>
                <input type="hidden" id="stressLevel">
            </div>

            <div class="custom-card mb-4 p-4">
                <h5 class="fw-bold mb-3">ğŸ½ï¸ í‰ì†Œ ì‹ìŠµê´€ (ë‹¤ì¤‘ ì„ íƒ)</h5>
                <div class="d-flex flex-wrap gap-2">
                    <button class="btn btn-outline-secondary rounded-pill diet-btn">ê· í˜• ì¡íŒ ì‹ì‚¬ë¥¼ ê·œì¹™ì ìœ¼ë¡œ í•´ìš”</button>
                    <button class="btn btn-outline-secondary rounded-pill diet-btn">ì•„ì¹¨ì„ ìì£¼ ê±¸ëŸ¬ìš”</button>
                    <button class="btn btn-outline-secondary rounded-pill diet-btn">ì±„ì†Œë‚˜ ê³¼ì¼ì„ ê±°ì˜ ì•ˆ ë¨¹ì–´ìš”</button>
                    <button class="btn btn-outline-secondary rounded-pill diet-btn">ê³ ê¸°ë‚˜ ê¸°ë¦„ì§„ ìŒì‹ì„ ì¢‹ì•„í•´ìš”</button>
                    <button class="btn btn-outline-secondary rounded-pill diet-btn">ì¸ìŠ¤í„´íŠ¸/ë°°ë‹¬ ìŒì‹ì„ ìì£¼ ë¨¹ì–´ìš”</button>
                </div>
            </div>

            <button class="btn btn-primary w-100 py-3 rounded-4 fw-bold shadow-sm" onclick="nextStep()">ë‹¤ìŒ Stepìœ¼ë¡œ ></button>
        </div>
    </div>
</div>

<script>
    // ì„±ë³„ ë²„íŠ¼
    document.querySelectorAll('.gender-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
            this.classList.add('active', 'bg-primary', 'text-white');
            document.getElementById('gender').value = this.dataset.value;
        });
    });

    // ìŠ¤íŠ¸ë ˆìŠ¤ ë²„íŠ¼ (ë‹¨ì¼ ì„ íƒ)
    document.querySelectorAll('.stress-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.stress-btn').forEach(b => b.classList.remove('active', 'btn-success', 'btn-warning', 'btn-danger', 'text-white'));
            this.classList.add('active', 'text-white');
            
            if(this.dataset.value === 'ë‚®ìŒ') this.classList.add('btn-success');
            if(this.dataset.value === 'ë³´í†µ') this.classList.add('btn-warning');
            if(this.dataset.value === 'ë†’ìŒ') this.classList.add('btn-danger');

            document.getElementById('stressLevel').value = this.dataset.value;
        });
    });

    // ì‹ìŠµê´€ ë²„íŠ¼ (ë‹¤ì¤‘ ì„ íƒ)
    document.querySelectorAll('.diet-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            this.classList.toggle('btn-outline-secondary');
            this.classList.toggle('btn-primary');
            this.classList.toggle('active');
        });
    });

    function nextStep() {
        const age = document.getElementById('age').value;
        const gender = document.getElementById('gender').value;
        const sleep = document.getElementById('sleepQuality').value;
        const stress = document.getElementById('stressLevel').value;
        
        // ì‹ìŠµê´€ ìˆ˜ì§‘
        const dietHabits = [];
        document.querySelectorAll('.diet-btn.active').forEach(b => dietHabits.push(b.innerText));

        // ìœ íš¨ì„± ê²€ì‚¬
        if(!age || !gender) { alert("ë‚˜ì´ì™€ ì„±ë³„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        if(!stress) { alert("ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
        if(dietHabits.length === 0) { alert("ì‹ìŠµê´€ì„ ìµœì†Œ 1ê°œ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

        // ë°ì´í„° ì €ì¥
        const step1Data = {
            age: parseInt(age),
            gender: gender,
            sleepQuality: parseInt(sleep),
            stressLevel: stress,
            dietHabits: dietHabits
        };
        
        sessionStorage.setItem('userProfile', JSON.stringify(step1Data));
        
        // ì´ë™
        location.href = "{{ url_for('survey_step2') }}";
    }
</script>
{% endblock %}